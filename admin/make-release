#!/bin/sh
# vim: expandtab sw=4 ts=4 sts=4:

# Usage: make-release [branch]

version=`tr , . < VERSION`

tmp=`mktemp -dt gammu-build-XXXXXX`

cd $tmp
echo Working in $tmp
if [ "x$1" = "xbranch" ] ; then
    rel=RELEASE_`echo -n $version|tr . _`
    svn cp -m "Tag release $version" svn+ssh://mort/home/svn/gammu/trunk svn+ssh://mort/home/svn/gammu/tags/$rel
    svn export svn+ssh://mort/home/svn/gammu/tags/$rel gammu-$version
else
    svn export svn+ssh://mort/home/svn/gammu/trunk gammu-$version
fi
tar cfz gammu-$version.tar.gz gammu-$version
tar cfj gammu-$version.tar.bz2 gammu-$version
mkdir build-win
cd build-win
cmake ../gammu-$version -DCROSS_MINGW=ON
make
cpack
mv Gammu-*-Windows.* ../

echo "Release is in $tmp directory"
